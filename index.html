<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FICHAS CASTRA PET</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style.css" />
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body id="checkout-page">
    <!-- Modal de carregamento e mensagens -->
    <div id="fade" class="hide">
        <div id="loader" class="spinner-border text-info hide" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <div id="message" class="hide">
            <div class="alert alert-light" role="alert">
                <h4>Mensagem:</h4>
                <p id="message-text"></p>
                <button id="close-message" type="button" class="btn btn-secondary">Fechar</button>
            </div>
        </div>
    </div>
    
    <!-- Container principal do formulário -->
    <div class="container mt-4 mb-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <!-- Cabeçalho -->
                <div class="text-center mb-5">
                    <h1 class="text-primary">CASTRA PET</h1>
                    <p class="lead text-muted">Sistema de Cadastro de Animais</p>
                </div>
                
                <!-- Formulário principal -->
                <div class="card shadow-lg">
                    <div class="card-body p-4">
                        <!-- Informações do Animal -->
                        <div class="mb-5">
                            <h2 class="text-center mb-4 border-bottom pb-2">
                                <i class="fas fa-paw mr-2"></i>Informações do Animal
                            </h2>
                            
                            <div class="row">
                                <!-- Microchip -->
                                <div class="col-md-6 mb-3">
                                    <label for="microchip" class="form-label">Microchip:</label>
                                    <input type="text" class="form-control" id="microchip" 
                                           placeholder="Número do microchip" maxlength="15">
                                </div>
                                
                                <!-- Nome do Animal -->
                                <div class="col-md-6 mb-3">
                                    <label for="animal" class="form-label">Nome do Animal:</label>
                                    <input type="text" class="form-control" id="animal" 
                                           placeholder="Nome do animal" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <!-- Espécie -->
                                <div class="col-md-4 mb-3">
                                    <label for="especie" class="form-label">Espécie:</label>
                                    <select class="form-control" id="especie" required>
                                        <option value="" selected disabled>Selecione a espécie</option>
                                        <option value="CÃO">CÃO</option>
                                        <option value="GATO">GATO</option>
                                    </select>
                                </div>
                                
                                <!-- Sexo -->
                                <div class="col-md-4 mb-3">
                                    <label for="sexo" class="form-label">Sexo:</label>
                                    <select class="form-control" id="sexo" required>
                                        <option value="" selected disabled>Selecione o sexo</option>
                                        <option value="MACHO">MACHO</option>
                                        <option value="FÊMEA">FÊMEA</option>
                                    </select>
                                </div>
                                
                                <!-- Pelagem -->
                                <div class="col-md-4 mb-3">
                                    <label for="pelagem" class="form-label">Pelagem:</label>
                                    <select class="form-control" id="pelagem" required>
                                        <option value="" selected disabled>Selecione a pelagem</option>
                                        <option value="PRETO">PRETO</option>
                                        <option value="BRANCO">BRANCO</option>
                                        <option value="CARAMELO">CARAMELO</option>
                                        <option value="MARROM">MARROM</option>
                                        <option value="MESCLADO">MESCLADO</option>
                                        <option value="CINZA">CINZA</option>
                                        <option value="AMARELO">AMARELO</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row">
                                <!-- Idade -->
                                <div class="col-md-4 mb-3">
                                    <label for="idade" class="form-label">Idade:</label>
                                    <select class="form-control" id="idade" required>
                                        <option value="" selected disabled>Selecione a idade</option>
                                        <option value="-6MESES">Até 6 meses</option>
                                        <option value="6-12MESES">6 a 12 meses</option>
                                        <option value="1a2ANOS">1 a 2 anos</option>
                                        <option value="3a4ANOS">3 a 4 anos</option>
                                        <option value="5a6ANOS">5 a 6 anos</option>
                                        <option value="7a8ANOS">7 a 8 anos</option>
                                        <option value="+8ANOS">Mais de 8 anos</option>
                                    </select>
                                </div>
                                
                                <!-- Porte -->
                                <div class="col-md-4 mb-3">
                                    <label for="porte" class="form-label">Porte:</label>
                                    <select class="form-control" id="porte" required>
                                        <option value="" selected disabled>Selecione o porte</option>
                                        <option value="PEQUENO">Pequeno (até 8kg)</option>
                                        <option value="MEDIO">Médio (8 a 15kg)</option>
                                        <option value="GRANDE">Grande (acima de 15kg)</option>
                                    </select>
                                </div>
                                
                                <!-- Raça -->
                                <div class="col-md-4 mb-3">
                                    <label for="raca" class="form-label">Raça definida?</label>
                                    <select class="form-control" id="raca" required>
                                        <option value="" selected disabled>Selecione uma opção</option>
                                        <option value="SIM">SIM</option>
                                        <option value="NÃO">NÃO</option>
                                        <option value="SRD">SRD (Sem Raça Definida)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Castrado -->
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="castra" class="form-label">Castrado:</label>
                                    <select class="form-control" id="castra" required>
                                        <option value="" selected disabled>Selecione uma opção</option>
                                        <option value="SIM">SIM</option>
                                        <option value="NÃO">NÃO</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Informações do Tutor -->
                        <div class="mb-5">
                            <h2 class="text-center mb-4 border-bottom pb-2">
                                <i class="fas fa-user mr-2"></i>Informações do Tutor
                            </h2>
                            
                            <div class="row">
                                <!-- Nome do Tutor -->
                                <div class="col-md-6 mb-3">
                                    <label for="tutor" class="form-label">Nome do Tutor:</label>
                                    <input type="text" class="form-control" id="tutor" 
                                           placeholder="Nome completo do tutor" required>
                                </div>
                                
                                <!-- CPF -->
                                <div class="col-md-6 mb-3">
                                    <label for="cpf" class="form-label">CPF:</label>
                                    <input type="text" class="form-control" id="cpf" 
                                           placeholder="000.000.000-00" required>
                                </div>
                            </div>
                            
                            <div class="row">
                                <!-- RG -->
                                <div class="col-md-4 mb-3">
                                    <label for="rg" class="form-label">RG:</label>
                                    <input type="text" class="form-control" id="rg" 
                                           placeholder="Número do RG" required>
                                </div>
                                
                                <!-- Celular -->
                                <div class="col-md-4 mb-3">
                                    <label for="cel" class="form-label">Celular:</label>
                                    <input type="text" class="form-control" id="cel" 
                                           placeholder="(00) 00000-0000" required>
                                </div>
                                
                                <!-- Email -->
                                <div class="col-md-4 mb-3">
                                    <label for="email" class="form-label">Email:</label>
                                    <input type="email" class="form-control" id="email" 
                                           placeholder="email@exemplo.com">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Endereço -->
                        <div class="mb-5">
                            <h2 class="text-center mb-4 border-bottom pb-2">
                                <i class="fas fa-home mr-2"></i>Endereço
                            </h2>
                            
                            <!-- CEP -->
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <label for="cep" class="form-label">CEP:</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="cep" 
                                               placeholder="00000-000" maxlength="9" required>
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button" 
                                                    onclick="buscarCEP()">Buscar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Logradouro e Número -->
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="logradouro" class="form-label">Logradouro:</label>
                                    <input type="text" class="form-control" id="logradouro" 
                                           placeholder="Rua, Avenida, etc." required>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="numero" class="form-label">Número:</label>
                                    <input type="text" class="form-control" id="numero" 
                                           placeholder="Nº" required>
                                </div>
                            </div>
                            
                            <!-- Complemento e Bairro -->
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="complemento" class="form-label">Complemento:</label>
                                    <input type="text" class="form-control" id="complemento" 
                                           placeholder="Apto, Casa, etc.">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="bairro" class="form-label">Bairro:</label>
                                    <input type="text" class="form-control" id="bairro" 
                                           placeholder="Bairro" required>
                                </div>
                            </div>
                            
                            <!-- Cidade e Estado -->
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="cidade" class="form-label">Cidade:</label>
                                    <input type="text" class="form-control" id="cidade" 
                                           placeholder="Cidade" required>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="estado" class="form-label">Estado:</label>
                                    <select class="form-control" id="estado" required>
                                        <option value="" selected disabled>Selecione o estado</option>
                                        <option value="AC">Acre</option>
                                        <option value="AL">Alagoas</option>
                                        <option value="AP">Amapá</option>
                                        <option value="AM">Amazonas</option>
                                        <option value="BA">Bahia</option>
                                        <option value="CE">Ceará</option>
                                        <option value="DF">Distrito Federal</option>
                                        <option value="ES">Espírito Santo</option>
                                        <option value="GO">Goiás</option>
                                        <option value="MA">Maranhão</option>
                                        <option value="MT">Mato Grosso</option>
                                        <option value="MS">Mato Grosso do Sul</option>
                                        <option value="MG">Minas Gerais</option>
                                        <option value="PA">Pará</option>
                                        <option value="PB">Paraíba</option>
                                        <option value="PR">Paraná</option>
                                        <option value="PE">Pernambuco</option>
                                        <option value="PI">Piauí</option>
                                        <option value="RJ">Rio de Janeiro</option>
                                        <option value="RN">Rio Grande do Norte</option>
                                        <option value="RS">Rio Grande do Sul</option>
                                        <option value="RO">Rondônia</option>
                                        <option value="RR">Roraima</option>
                                        <option value="SC">Santa Catarina</option>
                                        <option value="SP">São Paulo</option>
                                        <option value="SE">Sergipe</option>
                                        <option value="TO">Tocantins</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Botões de ação -->
                        <div class="text-center mt-4">
                            <button type="button" class="btn btn-primary btn-lg mr-3" onclick="validarESalvar()">
                                <i class="fas fa-save mr-2"></i>Salvar Cadastro
                            </button>
                            <button type="button" class="btn btn-secondary btn-lg" onclick="limparFormulario()">
                                <i class="fas fa-broom mr-2"></i>Limpar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Informações de contato -->
                <div class="text-center mt-4 text-muted">
                    <p>CASTRA PET - Sistema de Cadastro de Animais</p>
                    <p>Em caso de dúvidas, entre em contato: (00) 0000-0000</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="./js/script.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script>
        // Função para exibir mensagens
        function mostrarMensagem(texto, tipo = 'info') {
            const mensagemDiv = document.getElementById('message-text');
            const fadeDiv = document.getElementById('fade');
            const messageDiv = document.getElementById('message');
            
            mensagemDiv.textContent = texto;
            messageDiv.className = tipo === 'erro' ? 'alert alert-danger' : 'alert alert-success';
            fadeDiv.classList.remove('hide');
            messageDiv.classList.remove('hide');
        }
        
        // Fechar mensagem
        document.getElementById('close-message').addEventListener('click', function() {
            document.getElementById('fade').classList.add('hide');
            document.getElementById('message').classList.add('hide');
        });
        
        // Máscaras de entrada
        document.addEventListener('DOMContentLoaded', function() {
            // Máscara para CPF
            $('#cpf').mask('000.000.000-00');
            
            // Máscara para celular
            $('#cel').mask('(00) 00000-0000');
            
            // Máscara para CEP
            $('#cep').mask('00000-000');
            
            // Máscara para RG
            $('#rg').mask('00.000.000-0');
        });
        
        // Função para buscar CEP
        function buscarCEP() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            
            if (cep.length !== 8) {
                mostrarMensagem('CEP inválido! Digite 8 números.', 'erro');
                return;
            }
            
            mostrarCarregamento(true);
            
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (data.erro) {
                        mostrarMensagem('CEP não encontrado!', 'erro');
                        return;
                    }
                    
                    document.getElementById('logradouro').value = data.logradouro;
                    document.getElementById('bairro').value = data.bairro;
                    document.getElementById('cidade').value = data.localidade;
                    document.getElementById('estado').value = data.uf;
                    
                    mostrarMensagem('Endereço encontrado com sucesso!');
                    document.getElementById('numero').focus();
                })
                .catch(error => {
                    mostrarMensagem('Erro ao buscar CEP. Tente novamente.', 'erro');
                })
                .finally(() => {
                    mostrarCarregamento(false);
                });
        }
        
        // Função para mostrar/ocultar carregamento
        function mostrarCarregamento(mostrar) {
            const loader = document.getElementById('loader');
            const fade = document.getElementById('fade');
            
            if (mostrar) {
                fade.classList.remove('hide');
                loader.classList.remove('hide');
            } else {
                fade.classList.add('hide');
                loader.classList.add('hide');
            }
        }
        
        // Função para validar e salvar
        function validarESalvar() {
            // Coletar todos os dados
            const dados = {
                microchip: document.getElementById('microchip').value,
                animal: document.getElementById('animal').value,
                especie: document.getElementById('especie').value,
                sexo: document.getElementById('sexo').value,
                pelagem: document.getElementById('pelagem').value,
                idade: document.getElementById('idade').value,
                porte: document.getElementById('porte').value,
                raca: document.getElementById('raca').value,
                castra: document.getElementById('castra').value,
                tutor: document.getElementById('tutor').value,
                cpf: document.getElementById('cpf').value,
                rg: document.getElementById('rg').value,
                cel: document.getElementById('cel').value,
                email: document.getElementById('email').value,
                cep: document.getElementById('cep').value,
                logradouro: document.getElementById('logradouro').value,
                numero: document.getElementById('numero').value,
                complemento: document.getElementById('complemento').value,
                bairro: document.getElementById('bairro').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value,
                dataCadastro: new Date().toLocaleString('pt-BR')
            };
            
            // Validar campos obrigatórios
            const camposObrigatorios = [
                'animal', 'especie', 'sexo', 'pelagem', 'idade', 
                'porte', 'raca', 'castra', 'tutor', 'cpf', 'rg', 
                'cel', 'cep', 'logradouro', 'numero', 'bairro', 
                'cidade', 'estado'
            ];
            
            for (const campo of camposObrigatorios) {
                if (!dados[campo] || dados[campo].trim() === '') {
                    mostrarMensagem(`Por favor, preencha o campo: ${campo.replace(/([A-Z])/g, ' $1').trim()}`, 'erro');
                    document.getElementById(campo).focus();
                    return;
                }
            }
            
            // Validar email se fornecido
            if (dados.email && !validarEmail(dados.email)) {
                mostrarMensagem('Por favor, insira um email válido.', 'erro');
                document.getElementById('email').focus();
                return;
            }
            
            // Salvar dados
            salvarDadosCSV(dados);
        }
        
        // Função para validar email
        function validarEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Função para salvar dados em CSV
        function salvarDadosCSV(dados) {
            mostrarCarregamento(true);
            
            // Criar cabeçalho CSV
            const cabecalho = Object.keys(dados).join(';');
            const linha = Object.values(dados).join(';');
            const csvContent = cabecalho + '\n' + linha;
            
            // Criar blob e fazer download
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `castra_pet_${dados.animal}_${Date.now()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            setTimeout(() => {
                mostrarCarregamento(false);
                mostrarMensagem('Cadastro salvo com sucesso! Arquivo CSV baixado.');
                
                // Opcional: limpar formulário após salvar
                // limparFormulario();
            }, 1000);
        }
        
        // Função para limpar formulário
        function limparFormulario() {
            if (confirm('Tem certeza que deseja limpar todos os campos?')) {
                const form = document.querySelector('.card-body');
                const inputs = form.querySelectorAll('input, select, textarea');
                
                inputs.forEach(input => {
                    if (input.type !== 'button') {
                        input.value = '';
                    }
                });
                
                // Resetar selects para primeira opção
                const selects = form.querySelectorAll('select');
                selects.forEach(select => {
                    select.selectedIndex = 0;
                });
                
                mostrarMensagem('Formulário limpo com sucesso!');
            }
        }
    </script>
</body>
</html>
